{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\GIGABYTE\\\\Desktop\\\\dpma\\\\frontend\\\\src\\\\components\\\\posts\\\\post-form.js\";\nimport React, { useState, useRef, useCallback, useEffect } from \"react\";\nimport { Camera, Delete } from \"../../assets/icons/icons.js\";\nimport GetLocation from \"./post-form/get-location\";\nimport EmojyPicker from \"./post-form/emojy-picker\";\nimport ErrorModal from \"../../shared/models/error-model\";\nimport LoadingPage from \"../../shared/models/loading-modal\";\nimport { useFetch } from \"../../shared/hooks/useFetch\";\nimport PostImage from \"./post-form/post-image\";\nimport { useDispatch } from \"react-redux\";\nconst PostForm = React.memo(({\n  user\n}) => {\n  const {\n    loading,\n    request,\n    error,\n    clearError\n  } = useFetch();\n  const [title, setTitle] = useState(\"\");\n  const [location, setLocation] = useState(null);\n  const dispatch = useDispatch();\n  const filePickerRef = useRef();\n  const [previewUrl, setPreviewUrl] = useState();\n  const [files, setFiles] = useState();\n  const [imgData, setImgData] = useState();\n\n  const pickedHandler = event => {\n    let pickedFile;\n\n    if (event.target.files && event.target.files.length === 1) {\n      pickedFile = event.target.files[0];\n      setFiles(pickedFile);\n    }\n  };\n\n  const removeImage = idx => {\n    setFiles(null);\n    setPreviewUrl(null);\n  };\n\n  const pickImageHandler = () => {\n    filePickerRef.current.click();\n  };\n\n  const createPost = async data => {\n    try {\n      const formData = new FormData();\n\n      if (imgData && imgData.width) {\n        formData.append(\"x\", imgData.x);\n        formData.append(\"y\", imgData.y);\n        formData.append(\"width\", imgData.width);\n        formData.append(\"height\", imgData.height);\n      }\n\n      formData.append(\"title\", data.title);\n      formData.append(\"location\", data.location);\n      formData.append(\"img\", data.img);\n      formData.append(\"creator\", data.creator);\n      const responseData = await request(process.env.REACT_APP_BACKEND_URL + \"/posts\", \"post\", formData, {\n        Authorization: \"Bearer \" + user.token\n      });\n      const newPost = {\n        createdAt: new Date().toISOString(),\n        username: user.username,\n        img: user.img,\n        _id: user.id,\n        isOnline: true\n      };\n      dispatch({\n        type: \"CREATE_POST\",\n        payload: { ...responseData.data.post,\n          creator: newPost\n        }\n      });\n      dispatch({\n        type: \"ONE_MORE_POST\",\n        payload: { ...responseData.data.post,\n          creator: newPost\n        }\n      });\n      removeImage();\n      setTitle(\"\");\n      setLocation(null);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const handleChange = e => {\n    setTitle(e.target.value);\n  };\n\n  const addEmojy = e => {\n    setTitle(el => el + e);\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    createPost({\n      title,\n      img: files,\n      location,\n      creator: user.id\n    });\n  };\n\n  const setCropData = data => {\n    setImgData({ ...data\n    });\n  };\n\n  useEffect(() => {\n    if (!files) {\n      return;\n    }\n\n    const fileReader = new FileReader();\n\n    fileReader.onload = () => {\n      setPreviewUrl(fileReader.result);\n    };\n\n    fileReader.readAsDataURL(files);\n  }, [files]);\n  return React.createElement(\"div\", {\n    className: \"form__container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109\n    },\n    __self: this\n  }, loading && React.createElement(LoadingPage, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110\n    },\n    __self: this\n  }), error && React.createElement(ErrorModal, {\n    state: \"error\",\n    closeModal: clearError,\n    message: error,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"divider\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"form__heading\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115\n    },\n    __self: this\n  }, React.createElement(\"h3\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116\n    },\n    __self: this\n  }, \"Write a post\")), React.createElement(\"div\", {\n    className: \"form\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, React.createElement(\"form\", {\n    className: \"form__body big\",\n    onSubmit: handleSubmit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"form__user\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"form__user--img\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: user.img,\n    alt: \"aa\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"form__user--username\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }, React.createElement(\"h3\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }, user.username), location && React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }, location))), React.createElement(\"div\", {\n    className: \"form__unit my-2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"form__unit features\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  }, React.createElement(\"textarea\", {\n    value: title,\n    name: \"body\",\n    onChange: handleChange,\n    placeholder: \"what in your mind..?\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }), React.createElement(PostImage, {\n    previewUrl: previewUrl,\n    removeImage: removeImage,\n    setImgData: setCropData,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"features__icons\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"features__icons--body\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"icon\",\n    onClick: pickImageHandler,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144\n    },\n    __self: this\n  }, React.createElement(\"input\", {\n    ref: filePickerRef,\n    style: {\n      display: \"none\"\n    },\n    type: \"file\",\n    accept: \".png,.jpg,.jpeg\",\n    onChange: pickedHandler,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }), React.createElement(Camera, {\n    width: \"2.2rem\",\n    height: \"2.4rem\",\n    fill: previewUrl ? \"#1D8CF8\" : \"#8B8B85\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152\n    },\n    __self: this\n  })), React.createElement(EmojyPicker, {\n    handleChange: addEmojy,\n    style: {\n      top: \"-20rem\",\n      left: \"-20rem\"\n    },\n    className: \"emojy-picker\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }), React.createElement(GetLocation, {\n    location: location,\n    handleLocation: city => {\n      location ? setLocation(null) : setLocation(city);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }))))), React.createElement(\"button\", {\n    disabled: loading,\n    className: \"btn btn--contained1-primary mg-none\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }, loading ? \"Posting....\" : \"Post\"))));\n});\nexport default PostForm;","map":{"version":3,"sources":["C:/Users/GIGABYTE/Desktop/dpma/frontend/src/components/posts/post-form.js"],"names":["React","useState","useRef","useCallback","useEffect","Camera","Delete","GetLocation","EmojyPicker","ErrorModal","LoadingPage","useFetch","PostImage","useDispatch","PostForm","memo","user","loading","request","error","clearError","title","setTitle","location","setLocation","dispatch","filePickerRef","previewUrl","setPreviewUrl","files","setFiles","imgData","setImgData","pickedHandler","event","pickedFile","target","length","removeImage","idx","pickImageHandler","current","click","createPost","data","formData","FormData","width","append","x","y","height","img","creator","responseData","process","env","REACT_APP_BACKEND_URL","Authorization","token","newPost","createdAt","Date","toISOString","username","_id","id","isOnline","type","payload","post","err","console","log","handleChange","e","value","addEmojy","el","handleSubmit","preventDefault","setCropData","fileReader","FileReader","onload","result","readAsDataURL","display","top","left","city"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useCallback, useEffect } from \"react\";\r\nimport { Camera, Delete } from \"../../assets/icons/icons.js\";\r\nimport GetLocation from \"./post-form/get-location\";\r\nimport EmojyPicker from \"./post-form/emojy-picker\";\r\nimport ErrorModal from \"../../shared/models/error-model\";\r\nimport LoadingPage from \"../../shared/models/loading-modal\";\r\nimport { useFetch } from \"../../shared/hooks/useFetch\";\r\nimport PostImage from \"./post-form/post-image\";\r\nimport { useDispatch } from \"react-redux\";\r\n\r\nconst PostForm = React.memo(({ user }) => {\r\n  const { loading, request, error, clearError } = useFetch();\r\n  const [title, setTitle] = useState(\"\");\r\n  const [location, setLocation] = useState(null);\r\n  const dispatch = useDispatch();\r\n  const filePickerRef = useRef();\r\n  const [previewUrl, setPreviewUrl] = useState();\r\n  const [files, setFiles] = useState();\r\n  const [imgData, setImgData] = useState();\r\n\r\n  const pickedHandler = (event) => {\r\n    let pickedFile;\r\n    if (event.target.files && event.target.files.length === 1) {\r\n      pickedFile = event.target.files[0];\r\n      setFiles(pickedFile);\r\n    }\r\n  };\r\n  const removeImage = (idx) => {\r\n    setFiles(null);\r\n    setPreviewUrl(null);\r\n  };\r\n  const pickImageHandler = () => {\r\n    filePickerRef.current.click();\r\n  };\r\n  const createPost = async (data) => {\r\n    try {\r\n      const formData = new FormData();\r\n      if (imgData && imgData.width) {\r\n        formData.append(\"x\", imgData.x);\r\n        formData.append(\"y\", imgData.y);\r\n        formData.append(\"width\", imgData.width);\r\n        formData.append(\"height\", imgData.height);\r\n      }\r\n      formData.append(\"title\", data.title);\r\n      formData.append(\"location\", data.location);\r\n      formData.append(\"img\", data.img);\r\n      formData.append(\"creator\", data.creator);\r\n      const responseData = await request(\r\n        process.env.REACT_APP_BACKEND_URL + \"/posts\",\r\n        \"post\",\r\n        formData,\r\n        {\r\n          Authorization: \"Bearer \" + user.token,\r\n        }\r\n      );\r\n      const newPost = {\r\n        createdAt: new Date().toISOString(),\r\n        username: user.username,\r\n        img: user.img,\r\n        _id: user.id,\r\n        isOnline: true,\r\n      };\r\n      dispatch({\r\n        type: \"CREATE_POST\",\r\n        payload: {\r\n          ...responseData.data.post,\r\n          creator: newPost,\r\n        },\r\n      });\r\n      dispatch({\r\n        type: \"ONE_MORE_POST\",\r\n        payload: {\r\n          ...responseData.data.post,\r\n          creator: newPost,\r\n        },\r\n      });\r\n      removeImage();\r\n      setTitle(\"\");\r\n      setLocation(null);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n  const handleChange = (e) => {\r\n    setTitle(e.target.value);\r\n  };\r\n  const addEmojy = (e) => {\r\n    setTitle((el) => el + e);\r\n  };\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    createPost({ title, img: files, location, creator: user.id });\r\n  };\r\n  const setCropData = (data) => {\r\n    setImgData({ ...data });\r\n  };\r\n  useEffect(() => {\r\n    if (!files) {\r\n      return;\r\n    }\r\n    const fileReader = new FileReader();\r\n    fileReader.onload = () => {\r\n      setPreviewUrl(fileReader.result);\r\n    };\r\n    fileReader.readAsDataURL(files);\r\n  }, [files]);\r\n\r\n  return (\r\n    <div className=\"form__container\">\r\n      {loading && <LoadingPage />}\r\n      {error && (\r\n        <ErrorModal state=\"error\" closeModal={clearError} message={error} />\r\n      )}\r\n      <div className=\"divider\" />\r\n      <div className=\"form__heading\">\r\n        <h3>Write a post</h3>\r\n      </div>\r\n      <div className=\"form\">\r\n        <form className=\"form__body big\" onSubmit={handleSubmit}>\r\n          <div className=\"form__user\">\r\n            <div className=\"form__user--img\">\r\n              <img src={user.img} alt=\"aa\" />\r\n            </div>\r\n            <div className=\"form__user--username\">\r\n              <h3>{user.username}</h3>\r\n              {location && <span>{location}</span>}\r\n            </div>\r\n          </div>\r\n          <div className=\"form__unit my-2\">\r\n            <div className=\"form__unit features\">\r\n              <textarea\r\n                value={title}\r\n                name=\"body\"\r\n                onChange={handleChange}\r\n                placeholder=\"what in your mind..?\"\r\n              ></textarea>\r\n              <PostImage\r\n                previewUrl={previewUrl}\r\n                removeImage={removeImage}\r\n                setImgData={setCropData}\r\n              />\r\n              <div className=\"features__icons\">\r\n                <div className=\"features__icons--body\">\r\n                  <span className=\"icon\" onClick={pickImageHandler}>\r\n                    <input\r\n                      ref={filePickerRef}\r\n                      style={{ display: \"none\" }}\r\n                      type=\"file\"\r\n                      accept=\".png,.jpg,.jpeg\"\r\n                      onChange={pickedHandler}\r\n                    />\r\n                    <Camera\r\n                      width=\"2.2rem\"\r\n                      height=\"2.4rem\"\r\n                      fill={previewUrl ? \"#1D8CF8\" : \"#8B8B85\"}\r\n                    />\r\n                  </span>\r\n                  <EmojyPicker\r\n                    handleChange={addEmojy}\r\n                    style={{\r\n                      top: \"-20rem\",\r\n                      left: \"-20rem\",\r\n                    }}\r\n                    className=\"emojy-picker\"\r\n                  />\r\n                  <GetLocation\r\n                    location={location}\r\n                    handleLocation={(city) => {\r\n                      location ? setLocation(null) : setLocation(city);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <button\r\n            disabled={loading}\r\n            className=\"btn btn--contained1-primary mg-none\"\r\n          >\r\n            {loading ? \"Posting....\" : \"Post\"}\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\nexport default PostForm;\r\n"]},"metadata":{},"sourceType":"module"}