{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\GIGABYTE\\\\Desktop\\\\dpma\\\\frontend\\\\src\\\\components\\\\posts\\\\post-item.js\";\nimport React, { useState, useEffect, useCallback, useRef } from \"react\";\nimport { Menu_2, Heart, Heart_4, Comment2 } from \"../../assets/icons/icons\";\nimport PostModel from \"../../shared/models/post-model\";\nimport { useHttpClient } from \"../../shared/hooks/http-hook\";\nimport { Link } from \"react-router-dom\";\nimport LightBoxImage from \"./image-preview\";\nimport socket from \"../socket\";\n\nconst PostItem = ({\n  post,\n  path,\n  uid,\n  token,\n  img,\n  username\n}) => {\n  const [liked, setLiked] = useState(post.liked.indexOf(uid));\n  const nol = useRef(post.liked.length);\n  const test = useRef(null);\n  const {\n    sendRequest\n  } = useHttpClient();\n  const [isOpen, setIsOpen] = useState(false);\n\n  const handleLike = async () => {\n    try {\n      const like = await sendRequest(process.env.REACT_APP_BACKEND_URL + \"/posts/post\", \"PATCH\", JSON.stringify({\n        postId: post._id,\n        creator: uid,\n        img,\n        username\n      }), {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token\n      });\n      socket.emit(\"action\", { ...like,\n        type: \"SEND_NOTFY\"\n      });\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const [id, setId] = useState();\n  useEffect(() => {\n    if (test.current) {\n      const timer = setTimeout(() => {\n        handleLike();\n      }, 500);\n      return () => clearTimeout(timer);\n    }\n  }, [liked]);\n\n  const getLeftTime = oldTime => {\n    const now = new Date();\n    const leftTime = new Date(oldTime).getTime();\n    const leftHours = (now.getTime() - leftTime) / (1000 * 3600);\n\n    if (leftHours < 1) {\n      let t = Math.ceil(leftHours * 60);\n      return t + (t === 1 ? \" MINUTE\" : \" MINUTES\") + \" AGO\";\n    }\n\n    if (leftHours < 24) {\n      let t = Math.floor(leftHours);\n      return t + (t === 1 ? \" Hour\" : \" Hours\") + \" AGO\";\n    }\n\n    if (leftHours < 24 * 7) {\n      let t = Math.floor(leftHours / 24);\n      return t + (t === 1 ? \" Day\" : \" Day\") + \" AGO\";\n    }\n\n    if (leftHours < 24 * 30) {\n      let t = Math.floor(leftHours / (24 * 7));\n      return t + (t === 1 ? \" Week\" : \" Weeks\") + \" AGO\";\n    }\n\n    if (leftHours < 365 * 24) {\n      let t = Math.floor(leftHours / (24 * 30));\n      return t + (t === 1 ? \" Month\" : \" Months\") + \" AGO\";\n    } else {\n      let t = Math.floor(leftHours / (365 * 24));\n      return t + (t === 1 ? \" Year\" : \" Years\") + \" AGO\";\n    }\n  };\n\n  return React.createElement(\"div\", {\n    className: \"post\",\n    key: post._id,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81\n    },\n    __self: this\n  }, isOpen && React.createElement(LightBoxImage, {\n    image: isOpen,\n    closeLightBox: () => setIsOpen(false),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"post__header\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"post__header--info\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"post__header--img\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88\n    },\n    __self: this\n  }, post.creator.isOnline && React.createElement(\"div\", {\n    className: \"userActive\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89\n    },\n    __self: this\n  }), React.createElement(Link, {\n    to: `/user/${post.creator._id || post.creator}`,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: post.creator.img || img,\n    alt: \"aa\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91\n    },\n    __self: this\n  }))), React.createElement(\"div\", {\n    className: \"post__header--name\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94\n    },\n    __self: this\n  }, React.createElement(Link, {\n    to: `/user/${post.creator._id || post.creator}`,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"name\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96\n    },\n    __self: this\n  }, post.creator.username || username)), post.location !== \"null\" && React.createElement(\"span\", {\n    className: \"place\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99\n    },\n    __self: this\n  }, post.location))), uid === (post.creator._id ? post.creator._id : post.creator) && React.createElement(PostModel, {\n    path: path,\n    id: id || post._id,\n    title: post.title,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"post__menu\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"icon\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110\n    },\n    __self: this\n  }, React.createElement(Menu_2, {\n    width: \"2.3rem\",\n    height: \"2.3rem\",\n    fill: \"#fff\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }))))), post.title && React.createElement(\"div\", {\n    className: \"post__content\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, post.title ? post.title : null)), post.img && React.createElement(\"div\", {\n    className: \"post__body\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: post.img,\n    onClick: () => setIsOpen(post.img),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"post__tail\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"post__tail__communication\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"post__tail__communication__item\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"icon\",\n    onClick: () => {\n      liked < 0 ? ++nol.current : --nol.current;\n      setLiked(e => e === 0 ? -1 : e * -1);\n      if (!test.current) test.current = 1;\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  }, liked < 0 ? React.createElement(Heart, {\n    width: \"2rem\",\n    height: \"2rem\",\n    fill: \"#fff\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }) : React.createElement(Heart_4, {\n    width: \"2rem\",\n    height: \"2rem\",\n    fill: \"#fff\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141\n    },\n    __self: this\n  })), React.createElement(\"span\", {\n    className: \"nol\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144\n    },\n    __self: this\n  }, nol.current)), React.createElement(Link, {\n    to: `/post/${post._id}`,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"post__tail__communication__item\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"icon\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148\n    },\n    __self: this\n  }, React.createElement(Comment2, {\n    width: \"2rem\",\n    height: \"2rem\",\n    fill: \"#fff\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149\n    },\n    __self: this\n  })), React.createElement(\"span\", {\n    className: \"nol\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151\n    },\n    __self: this\n  }, post.comments ? post.comments.length : 0)))), React.createElement(\"div\", {\n    className: \"post__tail--time-left\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, getLeftTime(post.createdAt))));\n};\n\nexport default PostItem;","map":{"version":3,"sources":["C:/Users/GIGABYTE/Desktop/dpma/frontend/src/components/posts/post-item.js"],"names":["React","useState","useEffect","useCallback","useRef","Menu_2","Heart","Heart_4","Comment2","PostModel","useHttpClient","Link","LightBoxImage","socket","PostItem","post","path","uid","token","img","username","liked","setLiked","indexOf","nol","length","test","sendRequest","isOpen","setIsOpen","handleLike","like","process","env","REACT_APP_BACKEND_URL","JSON","stringify","postId","_id","creator","Authorization","emit","type","err","console","log","id","setId","current","timer","setTimeout","clearTimeout","getLeftTime","oldTime","now","Date","leftTime","getTime","leftHours","t","Math","ceil","floor","isOnline","location","title","e","comments","createdAt"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from \"react\";\r\nimport { Menu_2, Heart, Heart_4, Comment2 } from \"../../assets/icons/icons\";\r\nimport PostModel from \"../../shared/models/post-model\";\r\nimport { useHttpClient } from \"../../shared/hooks/http-hook\";\r\nimport { Link } from \"react-router-dom\";\r\nimport LightBoxImage from \"./image-preview\";\r\nimport socket from \"../socket\";\r\n\r\nconst PostItem = ({ post, path, uid, token, img, username }) => {\r\n  const [liked, setLiked] = useState(post.liked.indexOf(uid));\r\n  const nol = useRef(post.liked.length);\r\n  const test = useRef(null);\r\n  const { sendRequest } = useHttpClient();\r\n  const [isOpen, setIsOpen] = useState(false);\r\n\r\n  const handleLike = async () => {\r\n    try {\r\n      const like = await sendRequest(\r\n        process.env.REACT_APP_BACKEND_URL + \"/posts/post\",\r\n        \"PATCH\",\r\n        JSON.stringify({\r\n          postId: post._id,\r\n          creator: uid,\r\n          img,\r\n          username,\r\n        }),\r\n        {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: \"Bearer \" + token,\r\n        }\r\n      );\r\n\r\n      socket.emit(\"action\", {\r\n        ...like,\r\n        type: \"SEND_NOTFY\",\r\n      });\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n  \r\n  const [id, setId] = useState();\r\n  \r\n  useEffect(() => {\r\n    if (test.current) {\r\n      const timer = setTimeout(() => {\r\n        handleLike();\r\n      }, 500);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [liked]);\r\n  const getLeftTime = (oldTime) => {\r\n    const now = new Date();\r\n    const leftTime = new Date(oldTime).getTime();\r\n    const leftHours = (now.getTime() - leftTime) / (1000 * 3600);\r\n    if (leftHours < 1) {\r\n      let t = Math.ceil(leftHours * 60);\r\n      return t + (t === 1 ? \" MINUTE\" : \" MINUTES\") + \" AGO\";\r\n    }\r\n    if (leftHours < 24) {\r\n      let t = Math.floor(leftHours);\r\n      return t + (t === 1 ? \" Hour\" : \" Hours\") + \" AGO\";\r\n    }\r\n    if (leftHours < 24 * 7) {\r\n      let t = Math.floor(leftHours / 24);\r\n      return t + (t === 1 ? \" Day\" : \" Day\") + \" AGO\";\r\n    }\r\n    if (leftHours < 24 * 30) {\r\n      let t = Math.floor(leftHours / (24 * 7));\r\n      return t + (t === 1 ? \" Week\" : \" Weeks\") + \" AGO\";\r\n    }\r\n    if (leftHours < 365 * 24) {\r\n      let t = Math.floor(leftHours / (24 * 30));\r\n      return t + (t === 1 ? \" Month\" : \" Months\") + \" AGO\";\r\n    } else {\r\n      let t = Math.floor(leftHours / (365 * 24));\r\n      return t + (t === 1 ? \" Year\" : \" Years\") + \" AGO\";\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"post\" key={post._id}>\r\n      {isOpen && (\r\n        <LightBoxImage image={isOpen} closeLightBox={() => setIsOpen(false)} />\r\n      )}\r\n      \r\n      <div className=\"post__header\">\r\n        <div className=\"post__header--info\">\r\n          <div className=\"post__header--img\">\r\n            {post.creator.isOnline && <div className=\"userActive\"></div>}\r\n            <Link to={`/user/${post.creator._id || post.creator}`}>\r\n              <img src={post.creator.img || img} alt=\"aa\" />\r\n            </Link>\r\n          </div>\r\n          <div className=\"post__header--name\">\r\n            <Link to={`/user/${post.creator._id || post.creator}`}>\r\n              <span className=\"name\">{post.creator.username || username}</span>\r\n            </Link>\r\n            {post.location !== \"null\" && (\r\n              <span className=\"place\">{post.location}</span>\r\n            )}\r\n          </div>\r\n        </div>\r\n        {uid === (post.creator._id ? post.creator._id : post.creator) && (\r\n          <PostModel\r\n          path={path}\r\n          id={id || post._id}\r\n          title={post.title}\r\n          >\r\n          <div className=\"post__menu\">     \r\n            <span className=\"icon\">\r\n              <Menu_2 width=\"2.3rem\" height=\"2.3rem\" fill=\"#fff\" />\r\n            </span>\r\n          </div>\r\n          </PostModel>\r\n        )}\r\n      </div>\r\n      {post.title && (\r\n        <div className=\"post__content\">\r\n          <p>{post.title ? post.title : null}</p>\r\n        </div>\r\n      )}\r\n      {post.img && (\r\n        <div className=\"post__body\">\r\n          <img src={post.img} onClick={() => setIsOpen(post.img)} />\r\n        </div>\r\n      )}\r\n      <div className=\"post__tail\">\r\n        <div className=\"post__tail__communication\">\r\n          <div className=\"post__tail__communication__item\">\r\n            <span\r\n              className=\"icon\"\r\n              onClick={() => {\r\n                liked < 0 ? ++nol.current : --nol.current;\r\n                setLiked((e) => (e === 0 ? -1 : e * -1));\r\n                if (!test.current) test.current = 1;\r\n              }}\r\n            >\r\n              {liked < 0 ? (\r\n                <Heart width=\"2rem\" height=\"2rem\" fill=\"#fff\" />\r\n              ) : (\r\n                <Heart_4 width=\"2rem\" height=\"2rem\" fill=\"#fff\" />\r\n              )}\r\n            </span>\r\n            <span className=\"nol\">{nol.current}</span>\r\n          </div>\r\n          <Link to={`/post/${post._id}`}>\r\n            <div className=\"post__tail__communication__item\">\r\n              <span className=\"icon\">\r\n                <Comment2 width=\"2rem\" height=\"2rem\" fill=\"#fff\" />\r\n              </span>\r\n              <span className=\"nol\">\r\n                {post.comments ? post.comments.length : 0}\r\n              </span>\r\n            </div>\r\n          </Link>\r\n        </div>\r\n        <div className=\"post__tail--time-left\">\r\n          {getLeftTime(post.createdAt)}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\nexport default PostItem;\r\n"]},"metadata":{},"sourceType":"module"}